# 更新日志 / Changelog

## [2026-01-24] - 学生管理联动与无学生状态优化

### ✨ 新功能

**学生数据实时同步机制**
- 学生管理页面添加/编辑/删除学生后,自动通知所有页面刷新
- 顶部学生选择器实时更新,无需手动刷新
- 删除学生时自动选择下一个可用学生,避免空白状态

**空状态友好提示与导航**
- 统一所有页面的无学生状态提示样式
- "创建学生"文字变为可点击的超链接,一键跳转到学生管理
- 提示样式参考家长看板,保持视觉一致性

### 🐛 Bug 修复

**问题 1: 学生管理界面联动失效**
- ✅ 修复学生管理页面添加/删除学生时,其他页面未能及时联动的问题
- ✅ 实现基于 `window.postMessage` 的跨页面通信机制
- ✅ 主框架 (`app.html`) 监听学生数据变更并自动刷新

**问题 2: 无学生时错误跳转和弹窗**
- ✅ 修复访问需要学生的页面时弹出 alert 对话框的问题
- ✅ 修复强制跳转到家长看板导致标题与页面不一致的问题
- ✅ 修复学生管理页面无法访问导致系统不可用的问题
- ✅ 允许所有页面在无学生状态下正常加载并显示友好提示

### 🔄 优化改进

**访问控制优化**
- 区分"没有学生"和"有学生但未选择"两种情况
- 无学生时允许页面加载并显示友好提示,不再阻止访问
- 有学生但未选择时自动选择第一个学生
- 学生管理、账号管理、资料库维护等页面始终可访问

**导航体验优化**
- 取消初始化时的强制跳转,尊重用户的导航意图
- 删除最后一个学生后保持在当前页面,可立即创建新学生
- 不再弹出 alert 对话框,提供流畅的用户体验

### 📝 技术细节

#### 消息通信机制
```javascript
// 学生数据变更通知
window.parent.postMessage({type: 'studentsChanged'}, '*');

// 页面导航跳转
window.parent.postMessage({type: 'navigateToPage', page: 'profile.html'}, '*');
```

#### 页面分类
- **不需要学生的页面**: profile.html, account.html, admin-accounts.html, library*.html
- **支持"全部学生"模式**: dashboard.html, submit.html, practice.html
- **需要学生但允许空状态**: generate.html, knowledge.html

#### 访问控制流程
```
用户访问页面
  ↓
检查是否为不需要学生的页面
  ↓ 是 → 允许加载
  ↓ 否
检查是否完全没有学生
  ↓ 是 → 允许加载(显示空状态提示)
  ↓ 否
检查是否有学生但未选择
  ↓ 是 → 自动选择第一个学生
  ↓ 否 → 允许加载
```

### 📂 影响范围

**前端页面修改** (5 个文件):
- `frontend/app.html` - 主框架,访问控制和学生数据同步
- `frontend/profile.html` - 学生管理,添加数据变更通知
- `frontend/dashboard.html` - 家长看板,空状态提示优化
- `frontend/generate.html` - 生成练习单,空状态提示优化
- `frontend/knowledge.html` - 学习库管理,空状态提示优化

**新增文档** (3 个文件):
- `BUGFIX_STUDENT_SYNC.md` - 学生管理联动修复详细文档
- `FEATURE_EMPTY_STATE_LINKS.md` - 空状态提示优化详细文档
- `BUGFIX_NO_STUDENT_NAVIGATION.md` - 导航问题修复详细文档

### 🧪 测试建议

**核心测试场景**:
1. 在学生管理页面添加/编辑/删除学生,观察顶部学生选择器是否实时更新
2. 删除所有学生后,访问各个页面确认都能正常显示友好提示
3. 点击"创建学生"链接,确认能正确跳转到学生管理页面
4. 在学生管理页面删除最后一个学生,确认保持在当前页面
5. 无学生时刷新页面,确认不弹出 alert,页面正常加载

### 📊 用户体验改进

**修复前**:
- ❌ 添加/删除学生后需要刷新页面才能看到变化
- ❌ 无学生时弹出 alert 对话框阻止访问
- ❌ 强制跳转导致标题与页面不一致
- ❌ 学生管理页面无法访问,系统不可用

**修复后**:
- ✅ 学生数据实时同步,无需刷新
- ✅ 友好的空状态提示,引导用户创建学生
- ✅ 所有页面都能正常访问,标题一致
- ✅ 流畅的导航体验,无意外跳转

### 🔗 相关链接
- 详细技术文档: `BUGFIX_STUDENT_SYNC.md`
- 空状态优化文档: `FEATURE_EMPTY_STATE_LINKS.md`
- 导航修复文档: `BUGFIX_NO_STUDENT_NAVIGATION.md`

---

## [2026-01-23] - iPad/iOS 输入框显示修复

### 🐛 Bug 修复

**修复 iPad/iOS Safari 上输入框显示异常问题**

#### 问题描述
在 iPad 和 iOS 设备上访问系统时，部分输入框显示异常，影响用户体验。

#### 修复内容
- 将所有输入框字体大小从 `14px` 调整为 `16px`
  - 原因：iOS Safari 会对字体小于 16px 的输入框自动缩放，导致页面布局错乱
- 添加 `-webkit-appearance: none` 和 `appearance: none` 样式属性
  - 原因：移除 iOS 默认样式，确保输入框在移动设备上正确渲染

#### 影响范围
修复了以下 7 个前端页面的输入框样式：
- `frontend/account.html` - 账户管理页面
- `frontend/admin-accounts.html` - 管理员账户页面
- `frontend/generate.html` - 生成默写单页面
- `frontend/index.html` - 引导页
- `frontend/login.html` - 登录页面
- `frontend/practice.html` - 练习单管理页面
- `frontend/profile.html` - 个人资料页面

#### 技术细节
```css
/* 修复前 */
input { font-size: 14px; }

/* 修复后 */
input {
  font-size: 16px;
  -webkit-appearance: none;
  appearance: none;
}
```

#### 影响
- ✅ 解决 iPad/iOS 设备上输入框聚焦时的自动缩放问题
- ✅ 改善移动设备上的表单输入体验
- ✅ 统一跨平台输入框样式表现

---

## 历史版本

### [2026-01-22] - 学生选择器头像显示修复
- 修复 app.html 中学生选择器的头像显示问题

### [2026-01-21] - UI/UX 改进和新功能
- 改进用户界面和用户体验
- 添加新功能

### [2026-01-20] - 生成日志和 PDF 答案布局更新
- 更新生成日志功能
- 优化 PDF 答案布局

### [2026-01-19] - 账户管理和作用域
- 添加账户管理功能
- 实现账户作用域控制

### [2026-01-18] - 仪表板和学生导航更新
- 更新仪表板界面
- 改进学生导航功能
