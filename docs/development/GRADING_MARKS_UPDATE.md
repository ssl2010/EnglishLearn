# 批改图片标记方式修改

## 修改内容

### 之前的标记方式
- 所有答案都用**方框**标记
- 正确：绿色方框
- 错误：红色方框
- 未知：橙色方框

### 修改后的标记方式
- ✓ **正确答案**：绿色对号（checkmark）
- ✗ **错误答案**：红色圆圈（内含X）
- ？ **未知状态**：橙色方框（保持不变）

## 实现细节

### 绿色对号（正确）
```python
def draw_checkmark(draw, bbox, color="#19c37d", width=5):
    """在答案区域中心绘制对号"""
    # 计算对号的三个点：左点 -> 底点 -> 右上点
    # 形成经典的 ✓ 形状
```

**视觉效果**：
- 颜色：#19c37d（鲜绿色）
- 线宽：5像素
- 位置：答案bbox中心
- 大小：bbox较小边的30%

### 红色圆圈（错误）
```python
def draw_circle_cross(draw, bbox, color="#ef4444", width=5):
    """在答案区域中心绘制圆圈，内含X"""
    # 绘制圆圈
    # 内部绘制X（增强视觉识别）
```

**视觉效果**：
- 颜色：#ef4444（鲜红色）
- 圆圈线宽：5像素
- X线宽：4像素
- 位置：答案bbox中心
- 大小：bbox较小边的35%

### 橙色方框（未知）
保持原有实现，用于LLM未能判断正确性的情况。

## 代码位置

**文件**：backend/app/services.py

**修改范围**：984-1058行

**关键函数**：
- `draw_checkmark()` - 绘制对号
- `draw_circle_cross()` - 绘制圆圈+X
- 主循环中根据 `is_correct` 状态选择绘制方式

## 测试方法

1. 重启后端服务器（如果使用 --reload 则会自动重启）
2. 上传新的练习单照片进行识别
3. 查看"批改后图片"

**预期效果**：
- 所有正确答案显示绿色 ✓
- 所有错误答案显示红色 ⭕（内含X）
- LLM未判断的显示橙色方框

## 调整建议

如果标记**太大或太小**，可以调整size参数：

```python
# 在 draw_checkmark 中
size = min(x2 - x1, y2 - y1) * 0.3  # 改为 0.25 (更小) 或 0.35 (更大)

# 在 draw_circle_cross 中
radius = min(x2 - x1, y2 - y1) * 0.35  # 改为 0.3 (更小) 或 0.4 (更大)
```

如果标记**线条太粗或太细**，可以调整width参数：

```python
# 在主循环中
draw_checkmark(draw, abs_bbox, color="#19c37d", width=5)  # 改为 3-7
draw_circle_cross(draw, abs_bbox, color="#ef4444", width=5)  # 改为 3-7
```

## 注意事项

1. **服务器重启**：修改后需要重启后端服务（`--reload` 模式会自动重启）
2. **已生成的图片**：之前生成的批改图片不会改变，只影响新生成的图片
3. **性能影响**：绘制对号和圆圈比方框稍复杂，但性能影响可忽略
4. **清晰度**：对号和圆圈在小bbox上可能不如大bbox清晰，已优化线宽确保可见性

## 效果对比

| 状态 | 之前 | 修改后 |
|------|------|--------|
| 正确 | 绿色方框 | ✓ 绿色对号 |
| 错误 | 红色方框 | ⭕ 红色圆圈(内含X) |
| 未知 | 橙色方框 | 橙色方框（不变） |

修改后的标记更加直观和美观！
